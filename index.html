<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Automa Advanced Dashboard</title>
<!-- Bootstrap CDN for sleek UI -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana; background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; padding: 20px; color:#fff; }
  .card { background:#fff; color:#000; border-radius:10px; margin-top:20px; }
  .btn { margin:10px 0; }
  .toast-container { position: fixed; top: 20px; right:20px; z-index:9999; }
</style>
</head>
<body>

<div class="container">
<h1 class="text-center mb-4">🤖 Automa Advanced Dashboard</h1>

<div class="row">
  <div class="col-md-6 mb-3">
    <div class="card p-3 shadow">
      <h4 class="text-center">📊 Trigger Status</h4>
      <h2 id="triggerState" class="text-center text-success">OFF</h2>
      <div class="text-center" style="font-size:0.9em;">Last Updated: <span id="lastUpdated">-</span></div>
    </div>
  </div>
  <div class="col-md-6 mb-3">
    <div class="card p-3 shadow">
      <h4 class="text-center">⚙️ Workflow Status</h4>
      <h2 id="workflowState" class="text-center">Waiting...</h2>
    </div>
  </div>
</div>

<div class="d-grid gap-2 d-md-flex justify-content-center">
  <button class="btn btn-primary btn-lg" onclick="triggerWorkflow()">🚀 Trigger ON</button>
  <button class="btn btn-secondary btn-lg" onclick="resetWorkflow()">🔄 Reset to NO</button>
</div>

<!-- Toast for notifications -->
<div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer"></div>

</div>

<script>
const webhookURL = 'YOUR_DEPLOYED_APPS_SCRIPT_URL'; // Replace with your Apps Script URL

function showToast(message, type='success') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className='toast align-items-center text-white bg-'+(type==='success'?'success':'danger')+' border-0 show';
  toast.style.minWidth='250px';
  toast.innerHTML=`
    <div class="d-flex">
      <div class="toast-body">${message}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>`;
  container.appendChild(toast);
  setTimeout(()=>{ toast.remove(); }, 3000);
}

async function setSheetCell(value) {
  const response = await fetch(`${webhookURL}?action=setCell&value=${value}`, {method:'GET'});
  const text = await response.text();
  if(text.trim()=='OK') {
    updateStatus(value);
  } else {
    showToast('Sheet Update Failed', 'danger');
  }
}

async function getSheetCell() {
  const response = await fetch(`${webhookURL}?action=getCell`, {method:'GET'});
  const cellValue = await response.text();
  return cellValue.trim();
}

function updateStatus(val) {
  document.getElementById('triggerState').textContent= val;
  document.getElementById('lastUpdated').innerText= new Date().toLocaleString('hi-IN');
  document.getElementById('triggerState').className='text-'+(val=='ON'?'success':'danger');
}

async function triggerWorkflow() {
  await setSheetCell('YES');
  showToast('Trigger (YES) set! Workflow will start.');
  document.getElementById('workflowState').innerText='Triggered!';
}

async function resetWorkflow() {
  await setSheetCell('NO');
  updateStatus('OFF');
  document.getElementById('workflowState').innerText='Waiting...';
  showToast('Reset to NO');
}

// Periodic check of Sheet status
setInterval(async () => {
  const val= await getSheetCell();
  if(val=='YES' && document.getElementById('triggerState').innerText!='ON') {
    updateStatus('ON');
    document.getElementById('workflowState').innerText='Executing...';
    showToast('Detected trigger! Run your workflow.');
    // Optionally, auto reset trigger after
  }
}, 60000); // check every 1 min

// Load initial state
window.onload= ()=> {
  getSheetCell().then(val => updateStatus(val));
};
</script>
</body>
</html>
